# âš“ Day01 - Core Concepts

<br>

## Cluster Architecture

- ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ëª©ì ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ìŠ¤íŒ…í•˜ëŠ” ê²ƒì´ë‹¤.
- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìë™í™”ëœ ë°©ì‹ê³¼ ì»¨í…Œì´ë„ˆ í˜•íƒœë¡œ ì‰½ê²Œ ë°°í¬í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì˜ ì„œë¡œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ê°„ì˜ í†µì‹ ì„ í•„ìš”ì— ë”°ë¼ ì‰½ê²Œ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

### ì˜ˆì‹œ âš“

- ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” ë…¸ë“œë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ë¬¼ë¦¬ì  ë˜ëŠ” ê°€ìƒ, ì˜¨í”„ë ˆë¯¸ìŠ¤ ë˜ëŠ” í´ë¼ìš°ë“œì¼ ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³ , ì»¨í…Œì´ë„ˆ í˜•íƒœë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ìŠ¤íŒ…í•œë‹¤.

![image](https://user-images.githubusercontent.com/76610641/218308541-836d4b20-db76-448b-a084-7db994c60ece.png)

- ìœ„ ê·¸ë¦¼ì— ìˆëŠ” ë‘ ê°œì˜ ì„ ë°•ì´ ì»¨í…Œì´ë„ˆë¥¼ ì ì¬í•˜ê³  ìˆëŠ” worker ë…¸ë“œì´ë‹¤.
    - worker ë…¸ë“œëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì ì¬í•  ìˆ˜ ìˆë‹¤.

â“ **ê·¸ë ‡ë‹¤ë©´, ë¬´ì—‡ì´ ì»¨í…Œì´ë„ˆë¥¼ ë¡œë“œí• ê¹Œ?**

ğŸ’¡ **Master ë…¸ë“œê°€ ë‹´ë‹¹í•œë‹¤.**

![image](https://user-images.githubusercontent.com/76610641/218308584-83003a18-592e-48e3-82c6-dd40e29ab2b7.png)

- Master ë…¸ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¼ì„ í•œë‹¤.
    - ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ë¥¼ ìœ„í•´ ë‹¤ë¥¸ ë…¸ë“œì— ê´€í•œ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤.
    - ì–´ë–¤ ì»¨í…Œì´ë„ˆê°€ ì–´ë–¤ ë…¸ë“œë¡œ ê°ˆì§€ ê³„íší•œë‹¤.
    - ë…¸ë“œì™€ ì»¨í…Œì´ë„ˆ ë“±ì„ ëª¨ë‹ˆí„°ë§í•œë‹¤.
- Master ë…¸ë“œëŠ” ì»´í¬ë„ŒíŠ¸ ë™ì‘ì„ ì œì–´í•˜ëŠ” êµ¬ì„±ìš”ì†Œì˜ ì§‘í•©ì„ ì‚¬ìš©í•˜ì—¬ ìœ„ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

### êµ¬ì„±ìš”ì†Œ

![image](https://user-images.githubusercontent.com/76610641/218308611-d39b6d24-c766-42ee-82b0-5aa4ebe608e9.png)

- ğŸš¢ **Master Node êµ¬ì„± ìš”ì†Œ**
    
    ![image](https://user-images.githubusercontent.com/76610641/218308627-248672f8-642d-4ab0-9eb7-f3d046a7be14.png)

    - **ETCD**
        - ê³ ê°€ìš©ì„±ì„ ë³´ì¥í•˜ëŠ” í´ëŸ¬ìŠ¤í„° í˜•íƒœì˜ ì €ì¥ì†Œì´ë‹¤.
        - ì •ë³´ë¥¼ í‚¤ ê°’ í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤
    - **Kube-scheduler**
        - ì»¨í…Œì´ë„ˆë¥¼ ë°°ì¹˜í•  ì˜¬ë°”ë¥¸ ë…¸ë“œë¥¼ ì‹ë³„í•œë‹¤.
        - ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ìš”êµ¬ ì‚¬í•­, worker ë…¸ë“œ ìš©ëŸ‰ ë˜ëŠ” taintì™€ ê°™ì€ ì •ì±…ì´ë‚˜ ì œì•½ ì¡°ê±´ ë“±ì„ ì°¸ê³ í•˜ì—¬ ì ì ˆí•œ ë…¸ë“œë¥¼ ì„ íƒí•œë‹¤.
    - **Controller-Manager**
        - ë‹¤ì–‘í•œ ì˜ì—­ì„ ê´€ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬
        - ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ - ìƒˆ ë…¸ë“œë¥¼ í´ëŸ¬ìŠ¤í„°ì— ì˜¨ë³´ë”©, ë…¸ë“œë¥¼  ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œë˜ëŠ” ìƒí™© ì²˜ë¦¬
        - ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬  - ì›í•˜ëŠ” ë ˆí”Œë¦¬ì¹´ì˜ ìˆ˜ì˜ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘ì¸ì§€
    - **Kubernetes API**
        - í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ëª¨ë“  ì‘ì—…ì„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•œë‹¤.
        - ì™¸ë¶€ ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ëŠ” í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
        - Worker ë…¸ë“œì™€ í†µì‹ í•œë‹¤. ( kubeletê³¼ í†µì‹ )
- ğŸš¢ **Worker Node êµ¬ì„±ìš”ì†Œ**
    
    ![image](https://user-images.githubusercontent.com/76610641/218308664-5e401412-8555-4bcb-910b-0f20fe801afa.png)
    - **Container Runtime**
        - ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ëª¨ë‘ ì»¨í…Œì´ë„ˆë¡œ í˜¸ìŠ¤íŒ…ëœë‹¤.
        - ë”°ë¼ì„œ, í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì†Œí”„íŠ¸ì›¨ì–´ê°€ í•„ìš”í•˜ë‹¤.
        - ex. **ContainerD í˜¹ì€ Docker**
    - **kubelet**
        - í´ëŸ¬ìŠ¤í„°ì˜ ê° ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì—ì´ì „íŠ¸ì´ë‹¤.
        - Kube APIì˜ ëª…ë ¹ì„ ìˆ˜ì‹ í•œë‹¤.
        - í•„ìš”ì— ë”°ë¼ ë…¸ë“œì— ì»¨í…Œì´ë„ˆë¥¼ ë°°í¬í•˜ê±°ë‚˜ ì œê±°í•œë‹¤.
        - Kube APIì—ê²Œ ì£¼ê¸°ì ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ìƒíƒœë¥¼ ë³´ë‚¸ë‹¤.
    - k**ube-proxy**
        - í´ëŸ¬ìŠ¤í„° ë‚´ ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì¤€ë‹¤.

---

## ETCD

### **ë¶„ì‚° í‚¤ - ê°’ ì €ì¥ì†Œ**

- í‚¤ - ê°’ ì €ì¥ì†Œë€?
    
    ![image](https://user-images.githubusercontent.com/76610641/218308689-7447d646-f8fe-4fa9-83be-c10a1811b0c0.png)

    - ë¬¸ì„œ ë˜ëŠ” í˜ì´ì§€ í˜•íƒœë¡œ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤.
    - ê° ê°œì¸ì€ ë¬¸ì„œë¥¼ ì–»ê³ , ê°œì¸ì— ëŒ€í•œ ì •ë³´ëŠ” íŒŒì¼ í˜•íƒœë¡œ ì €ì¥ëœë‹¤.
    - ë”°ë¼ì„œ í•œ íŒŒì¼ì„ ë³€ê²½í•´ë„ ë‹¤ë¥¸ íŒŒì¼ì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠëŠ”ë‹¤.
    - ë°ì´í„°ê°€ ë³µì¡í•´ì§€ë©´ì„œ JSON ë˜ëŠ” YANOì™€ ê°™ì€ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.

### **ETCD ì—­í• **

- í´ëŸ¬ìŠ¤í„°ì— ê´€í•œ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤.
    - Nodes, PODs, Configs, Secrets, Accounts, Roles, Bindings ë“± ì— ê´€í•œ ì •ë³´
- kubectl get ëª…ë ¹ì–´ëŠ” ETCD ì„œë²„ì—ì„œ ì˜¨ ì •ë³´ë“¤ì´ë‹¤.
- í´ëŸ¬ìŠ¤í„° ë‚´ ëª¨ë“  ë³€ê²½ ì‚¬í•­ ë˜í•œ etcd ì„œë²„ì— ì—…ë°ì´íŠ¸ ëœë‹¤.
    - ì¶”ê°€ ë…¸ë“œ, íŒŒë“œ ë°°í¬ ë˜ëŠ” ë ˆí”Œë¦¬ì¹´ ì„¸íŠ¸ ë“±
- **ETCD í´ëŸ¬ìŠ¤í„° ë°°í¬**
    - ì„¤ì¹˜ë¥¼ í†µí•œ ë°°í¬ì™€ kubeadm toolì„ ì‚¬ìš©í•´ì„œ ë°°í¬í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
    - **ë°”ì´ë„ˆë¦¬ íŒŒì¼ ì„¤ì¹˜ë¥¼ í†µí•œ ë°°í¬**
        - Master ë…¸ë“œì—ì„œ ì§ì ‘ ë°”ì´ë„ˆë¦¬ ì„¤ì¹˜ ë° etcdë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì´ë‹¤.
        - ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬ë˜ëŠ” ì˜µì…˜ 1 : ì¸ì¦ì„œ
        - ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬ë˜ëŠ” ì˜µì…˜ 2 : í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œ ì£¼ëª©í•´ì•¼í•˜ëŠ” advertise-client-urls ( ETCDê°€ ì²­ì·¨í•˜ëŠ” ì£¼ì†Œ, ì„œë²„IPì™€ í¬íŠ¸ 2379)
            - kube API ì„œë²„ì—ì„œ etcdì— ë„ë‹¬í•˜ë ¤ê³  í•  ë•Œ ì‚¬ìš©ëœë‹¤.
    - **kubeadmì„ ì´ìš©í•œ ë°°í¬**
        - Podë¡œ etcd ì„œë²„ë¥¼ ë°°í¬í•œë‹¤.
        - Pod ë‚´ì—ì„œ etcd ìœ í‹¸ë¦¬í‹°ë¥¼ ì‚¬ìš©í•œë‹¤.
        
        ```bash
        # Podë¡œ etcd ì„œë²„ë¡œ ë°°í¬ëœ ê²ƒ í™•ì¸
        kubectl get pods -n kube-system
        etcd-master
        
        # kubernetesì— ì €ì¥ëœ ëª¨ë“  í‚¤ ë‚˜ì—´
        kubectl exec etcd-master -n kube-system etcdctl get / --prefix -keys-only
        # ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” íŠ¹ì • ë””ë ‰í† ë¦¬ êµ¬ì¡°ì— ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.
        # ë£¨íŠ¸ ë””ë ‰í† ë¦¬ëŠ” ë ˆì§€ìŠ¤íŠ¸ë¦¬ì´ë©° ê·¸ ì•„ë˜ ë‹¤ì–‘í•œ êµ¬ì„±ì´ ìˆë‹¤.
        ```
        
    - kubernetesëŠ” ê³ ê°€ìš©ì„±ì„ ìœ„í•´ ì—¬ëŸ¬ê°œì˜ Master Nodeê°€ ìˆëŠ”ë°, ETCD ë˜í•œ Master ë…¸ë“œì— ë¶„ì‚°ë˜ì–´ ì—¬ëŸ¬ê°œë¥¼ ê°–ëŠ”ë‹¤.
    - ë”°ë¼ì„œ ë¶„ì‚°ë˜ì–´ ìˆëŠ” ETCDëŠ” ì„œë¡œì— ëŒ€í•´ ì•Œê³ ìˆì–´ì•¼ í•œë‹¤.
        
        ![image](https://user-images.githubusercontent.com/76610641/218308702-27a9b0c8-92f1-4c0c-a8f4-7defd6064c14.png)

        - ì´ˆê¸° í´ëŸ¬ìŠ¤í„° ì˜µì…˜ì„ í†µí•´ etcd ì„œë¹„ìŠ¤ì˜ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•´ì•¼ í•œë‹¤.

### **ETCD ì„¤ì¹˜ ë° ì‘ë™**

```bash
# ë°”ì´ë„ˆë¦¬ ë‹¤ìš´ë¡œë“œ - GitHub ë¦´ë¦¬ì¦ˆì—ì„œ ìš´ì˜ì²´ì œì— ë§ëŠ” ë°”ì´ë„ˆë¦¬ ë‹¤ìš´ë¡œë“œ
curl -L https://github.com/etcd-io/etcd/releases/download/v3.3.11/etcdv3.3.11-linux-amd64.tar.gz -o etcd-v3.3.11-linux-amd64.tar.gz

# ì••ì¶• í’€ê¸°
tar xzvf etcd-v3.3.11-linux-amd64.tar.gz

# ETCD ì„œë¹„ìŠ¤ ì‹¤í–‰
./etcd
```

- **ETCD ì‹¤í–‰**
    - ê¸°ë³¸ **2379 í¬íŠ¸**ì—ì„œ ìˆ˜ì‹ í•œë‹¤.
    - ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ê¸° ìœ„í•´ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ë¥¼ ETCD ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆë‹¤.
    - ê¸°ë³¸ í´ë¼ì´ì–¸íŠ¸ëŠ” ETCD ì œì–´ í´ë¼ì´ì–¸íŠ¸ì´ë‹¤.
        - ETCD Command Line í´ë¼ì´ì–¸íŠ¸ì´ë‹¤.
        - ì´ë¥¼ ì´ìš©í•´ í‚¤-ê°’ ìŒì„ ì €ì¥í•˜ê³  ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤.

```bash
# ETCD ì‹¤í–‰
./etcd

# í‚¤-ê°’ ì €ì¥
./etcdctl set key1 value1

# ì €ì¥ëœ ë°ì´í„° ê²€ìƒ‰
./etcdctl get key1

# ì˜µì…˜ ê²€ìƒ‰
./etcdctl

# ë²„ì „ ê²€ìƒ‰
./etcdctl --version
```

### **ETCD ë²„ì „**

- Version 0.1
    - 2013ë…„ 8ì›” ì¶œì‹œ
- Version 2.0 (ê³µì‹ ì•ˆì • ë²„ì „)
    - 2015ë…„ 2ì›” ì¶œì‹œ
    - RAFT í•©ì˜ ì•Œê³ ë¦¬ì¦˜ ì¬ì„¤ê³„, ì´ˆë‹¹ 10,000íšŒ ì´ìƒì˜ ì“°ê¸° ì§€ì›
- Version 3.0
    - 2017ë…„ 1ì›” ì¶œì‹œ
    - ìµœì í™”ì™€ ì„±ëŠ¥ í–¥ìƒ ì œê³µ
- ETCD í”„ë¡œì íŠ¸ â†’ CNCF
    - 2018ë…„ 11ì›”
- v2ì™€ v3 ì‚¬ì´ì— ë§ì€ ë³€í™”ê°€ ìˆì—ˆë‹¤.
- ë”°ë¼ì„œ API ë²„ì „ë„ v2ì—ì„œ v3ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆë‹¤.
    - etcdctl ëª…ë ¹ë„ ë³€ê²½ë˜ì—ˆë‹¤ëŠ” ê²ƒ!
- ë”°ë¼ì„œ v2ì™€ v3ë¥¼ ë™ì‹œì— ì‚¬ìš©í•œë‹¤.
- ìµœì‹  ë²„ì „ì—ì„œ ETCDì˜ ê¸°ë³¸ API ë²„ì „ì€ v3ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤.

```bash
# API v3ë¡œ ë³€ê²½í•˜ê¸°

# API v3ì—ì„œ ì‘ë™ (í™˜ê²½ë³€ìˆ˜ ì´ìš©)
ETCDCTL_API=3 ./etcdctl version

# í™˜ê²½ë³€ìˆ˜ë¡œ ë‚´ë³´ë‚´ì„œ ì„¤ì •í•˜ê¸°
export ETCDCTL_API=3 ./etcdctl version

# ETCDCTL v3
export ECTDCTL_API=3 ./etcdctl version
./etcdctl put key1 value1 # ê°’ ì„¤ì • (set -> put)
./etcdctl get key1 # ê°’ ê°€ì ¸ì˜´
```

âš™ï¸ ETCDCTL

- ETCDì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” CLI ë„êµ¬ì´ë‹¤.
- ETCDCTLì€ 2ê°œì˜ API ë²„ì „ (v2, v3)ì„ ì‚¬ìš©í•œë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ v2ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆë‹¤.**

- â€”â€”â€”â€”v2â€”â€”â€”â€”
- etcdctl backup
- etcdctl cluster-health
- etcdctl mk
- etcdctl mkdir
- etcdctl set

- â€”â€”â€”â€”v3â€”â€”â€”â€”
- etcdctl snapshot save
- etcdctl endpoint health
- etcdctl get
- etcdctl put

**í™˜ê²½ë³€ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ECTDCTL_APIë¥¼ v3ë¡œ ë°”ê¾¸ëŠ” ë°©ë²•**

export ETCDCTL_API=3


---

## Kube-api server

![image](https://user-images.githubusercontent.com/76610641/218308814-6caf11fd-adde-4692-b931-76255d4a2955.png)
- ì¿ ë²„ë„¤í‹°ìŠ¤ ê¸°ë³¸ ê´€ë¦¬ êµ¬ì„± ìš”ì†Œì´ë‹¤.
- kubectl ëª…ë ¹ì„ ì…ë ¥í•˜ë©´ kube-apiserverì— ìš”ì²­ì„ ì¸ì¦í•˜ê³  ê²€ì¦í•œë‹¤.
- ê·¸í›„ ë°ì´í„°ë¥¼ etcd í´ëŸ¬ìŠ¤í„°ì—ì„œ ê²€ìƒ‰í•˜ê³ , ì‘ë‹µí•œë‹¤.
- kubectl ëª…ë ¹ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  APIë¥¼ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ë„ ìˆë‹¤.
    
    curl -X POST /api/v1/namespaces/default/pods
    

### create pod ë™ì‘ ê³¼ì •

- Userê°€ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.
- ìš”ì²­ì— ëŒ€í•œ ì¸ì¦, ì¸ê°€ë¥¼ í†µí•´ ìœ íš¨ì„±ì„ ê²€ì‚¬í•œë‹¤.
- ì´í›„ API ì„œë²„ëŠ” ë…¸ë“œì— í• ë‹¹í•˜ì§€ ì•Šê³ , Pod ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
- ETCD ì„œë²„ì— í•´ë‹¹ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤. (Podë¥¼ ìƒì„±í•œ Userë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤)
- ìŠ¤ì¼€ì¤„ëŸ¬ê°€ API ì„œë²„ë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•œë‹¤. â†’ í• ë‹¹ëœ ë…¸ë“œê°€ ì—†ëŠ” ìƒˆë¡œìš´ Podê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•œë‹¤. ì´í›„ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ìƒˆ Podë¥¼ ìœ„ì¹˜ì‹œí‚¬ ì˜¬ë°”ë¥¸ ë…¸ë“œë¥¼ ì‹ë³„í•œë‹¤. ì´í›„ ì´ë¥¼ kube-apiserverì— ì „ë‹¬í•œë‹¤.
- kube-apiserverì€ ì´ì— ëŒ€í•œ ì •ë³´ë¥¼ ETCDì— ì—…ë°ì´íŠ¸í•œë‹¤.
- ì´í›„ kube-apiserverì€ ì ì ˆí•œ ë…¸ë“œì˜ kubeletì— í•´ë‹¹ ì •ë³´ë¥¼ ì „ë‹¬í•œë‹¤.
- kubeletì€ í•´ë‹¹ ë…¸ë“œì— Podë¥¼ ìƒì„±í•˜ê³ , ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ì—”ì§„ì— ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¯¸ì§€ ë°°í¬ë¥¼ ì§€ì‹œí•œë‹¤.
- í•´ë‹¹ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ kubeletì´ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , ì´ë¥¼ kube-apiserverì— ì „ë‹¬í•œë‹¤.
- kube-apiserverì€ í•´ë‹¹ ë‚´ìš©ì„ ETCDì— ì—…ë°ì´íŠ¸í•œë‹¤.

### kube-apiserverì˜ ì—­í• 

![image](https://user-images.githubusercontent.com/76610641/218308835-7efb0338-9368-4925-8626-1f06c709ed74.png)

- ì¸ì¦, ì¸ê°€
- ìš”ì²­ í™•ì¸
- ETCD ë°ì´í„° ì €ì¥ì†Œì— ë°ì´í„° ê²€ìƒ‰ ë° ì—…ë°ì´íŠ¸
    - ETCD ë°ì´í„° ì €ì¥ì†Œì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•˜ëŠ” ìœ ì¼í•œ ì»´í¬ë„ŒíŠ¸ì´ë‹¤.
- kubelet, kube-controller-manager, scheduler ì—…ë°ì´íŠ¸ ìˆ˜í–‰

### kube-apiserver with ë°”ì´ë„ˆë¦¬

Master ë…¸ë“œì—ì„œ ì„œë¹„ìŠ¤ë¡œ ì‹¤í–‰ë˜ë„ë¡ êµ¬ì„±í•œë‹¤.

```bash
# kubernetes ë¦´ë¦¬ìŠ¤ í˜ì´ì§€ì˜ ë°”ì´ë„ˆë¦¬ ë‹¤ìš´ë¡œë“œ
wget https://storage.googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-apiserver
```

**í´ëŸ¬ìŠ¤í„°ì˜ ë‹¤ì–‘í•œ êµ¬ì„±ìš”ì†Œ (ì¸ì¦ì„œ)**

![image](https://user-images.githubusercontent.com/76610641/218308848-2257e98e-5e24-4fa5-8382-cf8a410ca77d.png)

- ì„œë¡œ í†µì‹ í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì¸ì¦ ë°©ì‹ì´ ìˆë‹¤. (ìŠ¹ì¸, ì•”í˜¸í™” ë° ë³´ì•ˆ)
- ì¸ì¦ì„œê°€ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„!

**ETCD ì„œë²„ ìœ„ì¹˜ ì§€ì •**

![image](https://user-images.githubusercontent.com/76610641/218308868-29bc35e4-cc2a-4c71-8aa2-dd10cd45dfa7.png)

- ETCD ì„œë²„ ìœ„ì¹˜ë¥¼ ì§€ì •í•œë‹¤.
- ETCDì™€ kube-apiserverì™€ ì—°ê²°í•˜ëŠ” ë°©ë²•ì´ë‹¤.

**kubeadmìœ¼ë¡œ ì„¤ì •í•˜ì—¬ kube-apiserver ì˜µì…˜ ê²€ì‚¬**

![image](https://user-images.githubusercontent.com/76610641/218308881-840e86f4-8345-477c-9365-ae204e3acf03.png)

- kubeadmì€ kubeadm-apiserverì„ ë§ˆìŠ¤í„° ë…¸ë“œì˜ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ Podë¡œ ë°°í¬í•œë‹¤.
- ë”°ë¼ì„œ Pod ì •ì˜ íŒŒì¼ ë‚´ì—ì„œ ì˜µì…˜ì„ ë³¼ ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/76610641/218308896-387fba43-266a-44cd-825e-f14a010467b1.png)

**kubeadmê°€ ì•„ë‹Œ ì„¤ì •ì—ì„œ ì˜µì…˜ ê²€ì‚¬**

![image](https://user-images.githubusercontent.com/76610641/218308909-05f9b626-2a04-47eb-accb-d2f0e462d601.png)

**ì‹¤í–‰ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ë‚˜ì—´ì„ í†µí•´ kube-apiserver ì˜µì…˜ ê²€ì‚¬**

![image](https://user-images.githubusercontent.com/76610641/218308920-6dafa23c-252c-4bfb-8e36-78d8c6d77487.png)

---

## Kube-Controller-Manager

- kubernetesì—ì„œ ë‹¤ì–‘í•œ ì»¨íŠ¸ë¡¤ëŸ¬ ê´€ë¦¬í•œë‹¤.
- ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì§€ì†ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ë‚´ì˜ ë‹¤ì–‘í•œ êµ¬ì„±ìš”ì†Œ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•œë‹¤.
- ì „ì²´ ì‹œìŠ¤í…œì„ ì›í•˜ëŠ” ìƒíƒœë¡œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ë…¸ë ¥í•œë‹¤.
- Node Controller, Replication Controller ë“± ë‹¤ì–‘í•œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìˆë‹¤.
    
    ![image](https://user-images.githubusercontent.com/76610641/218308936-6f3af904-6b02-4b4f-a8d9-32db67224633.png)

### **Node Controller**

![image](https://user-images.githubusercontent.com/76610641/218308968-151199b5-053b-4778-b3c2-63a66ca6a256.png)

- ë…¸ë“œì˜ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
- kube-apiserverì„ í†µí•´ ìˆ˜í–‰í•œë‹¤.
- ë…¸ë“œì˜ ìƒíƒœë¥¼ 5ì´ˆë§ˆë‹¤ ëª¨ë‹ˆí„°ë§í•˜ê³ , ë§Œì•½ ë…¸ë“œê°€ ë©ˆì·„ë‹¤ë©´ 40ì´ˆ ë’¤ ë…¸ë“œë¥¼ unreachableë¡œ í‘œì‹œí•œë‹¤.
- ì´í›„, 5ë¶„ ë™ì•ˆ ë‹¤ì‹œ ë˜ëŒì•„ ì˜¬ ìˆ˜ ìˆê²Œ ê¸°ë‹¤ë¦°ë‹¤.
- ë§Œì•½ ê·¸ ì´í›„ì—ë„ ì•ˆ ëŒì•„ì˜¨ë‹¤ë©´ í•´ë‹¹ ë…¸ë“œì— í• ë‹¹ëœ Podë¥¼ ì œê±°í•˜ê³ , ë‹¤ë¥¸ ê±´ê°•í•œ ë…¸ë“œë¥¼ ê³¨ë¼ replica ìˆ˜ì— ë§ì¶° ì¬í• ë‹¹í•´ì¤€ë‹¤.

### **Replication Controller**

- replica set ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , ìš”êµ¬í•˜ëŠ” Pod ìˆ˜ë¥¼ ë³´ì¥í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
- Podê°€ ì£½ìœ¼ë©´ ë‹¤ë¥¸ Podë¥¼ ìƒì„±í•œë‹¤.

### Controller Manager ì„¤ì¹˜

- ì—¬ëŸ¬ê°€ì§€ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” Kubernetes Controller Manager ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ë¡œ íŒ¨í‚¤ì§€ëœë‹¤.
- ë”°ë¼ì„œ, Kubernetes Controller Managerë¥¼ ì„¤ì¹˜í•˜ë©´ ë‹¤ë¥¸ ì»¨íŠ¸ë¡¤ëŸ¬ë„ ëª¨ë‘ ì„¤ì¹˜ëœë‹¤.

```bash
# kubernetes ë¦´ë¦¬ìŠ¤ í˜ì´ì§€ì—ì„œ ë‹¤ìš´ë¡œë“œ
wget https://storage.googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-controller-manager
```

**ì„¤ì¹˜ ì‹œ ì˜µì…˜ ëª©ë¡ í™•ì¸**

![image](https://user-images.githubusercontent.com/76610641/218308977-3fc93b27-0a5f-465d-95c2-8146397b2206.png)

**kubeadm toolë¡œ ì„¤ì •í•˜ëŠ” ê²½ìš° ì˜µì…˜ ë³´ê¸°**

![image](https://user-images.githubusercontent.com/76610641/218308992-70a31a63-bf3b-41ae-9af9-9e766dc7ca45.png)

- kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— Podë¡œ ë°°í¬ëœë‹¤.
- Pod ì •ì˜ íŒŒì¼ë‚´ /etc/kubernetes/manifests/ì— ì •ì˜ëœ í´ë”ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/76610641/218309010-ff79a56d-a598-4345-89a0-61342123ddb4.png)

**kubeadm toolë¡œ ì„¤ì •í•˜ì§€ ì•Šì€ ê²½ìš° ì˜µì…˜ ë³´ê¸°**

![image](https://user-images.githubusercontent.com/76610641/218309037-5cd24725-ca77-4a3e-9bee-0d134fb2749a.png)

![image](https://user-images.githubusercontent.com/76610641/218309024-f3b8b302-9e40-4088-96f4-3a7ca50ff088.png)

---

## Kube Scheduler

- ë…¸ë“œì—ì„œ Pod ì˜ˆì•½ì„ ë‹´ë‹¹í•œë‹¤.
- ì‹¤ì œë¡œ ë°°ì¹˜ëŠ” ë‹´ë‹¹í•˜ì§€ ì•ŠëŠ”ë‹¤. (ì‹¤ì œ PodëŠ” Worker ë…¸ë“œì˜  Kubelet ë§Œë“ ë‹¤)
- ì¦‰, ì–´ë–¤ Podê°€ ì–´ë””ë¡œ ê°€ëŠ”ì§€ ê²°ì •í•œë‹¤.

### ìŠ¤ì¼€ì¤„ëŸ¬ ìˆ˜í–‰ ë°©ë²•

- ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ê° Podë¥¼ í™•ì¸í•œë‹¤.
- ê·¸ë¦¬ê³  ë¦¬ì†ŒìŠ¤ ë“±ì„ í™•ì¸í•˜ì—¬ ìµœì ì˜ ë…¸ë“œë¥¼ ì°¾ìœ¼ë ¤ê³  í•œë‹¤.
- Podì— ê°€ì¥ ì í•©í•œ ë…¸ë“œë¥¼ ì‹ë³„í•œë‹¤.
    1. Podì˜ ë¦¬ì†ŒìŠ¤ì— ë§ì§€ ì•Šì€ ë…¸ë“œë¥¼ í•„í„°ë§í•œë‹¤.
    2. ê°€ëŠ¥í•œ Podë¥¼ ì¤‘ ë…¸ë“œì˜ ìˆœìœ„ë¥¼ ë§¤ê¸´ë‹¤.
        1. ìš°ì„ ìˆœìœ„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì ìˆ˜ë¥¼ í• ë‹¹í•œë‹¤.
    - ìŠ¤ì¼€ì¤„ë§ ë°©ë²•ì€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•˜ë‹¤.

### ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì¹˜

```bash
# ë¦´ë¦¬ìŠ¤ í˜ì´ì§€ì—ì„œ ë‹¤ìš´ë¡œë“œ
wget https://storage.googleapis.com/kubernetes-release/release/v1.13.0/bin/linux/amd64/kube-scheduler
```

**kubeadm ë„êµ¬ ì„¤ì¹˜ì‹œ scheduler ì˜µì…˜ ë³´ê¸°**

- Master ë…¸ë“œì˜ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ Podë¡œ ë°°í¬ë˜ê¸° ë•Œë¬¸ì—, Pod ì •ì˜ íŒŒì¼ ë‚´ì—ì„œ ì˜µì…˜ì„ ë³¼ ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/76610641/218309048-dd334827-803a-46f2-87de-0d709605e787.png)

**ì‹¤í–‰ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¡œ ì˜µì…˜ ë³´ê¸°**

![image](https://user-images.githubusercontent.com/76610641/218309061-d9b486aa-ee18-4192-8b93-fe90f20e4e5c.png)
